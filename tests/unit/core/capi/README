TODO: There is some issue with circular dependencies in the CAPI which only shows up when running the tests.